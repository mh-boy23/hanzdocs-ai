import React, { useState, useEffect, useRef } from 'react';
import { 
  User, Mail, Phone, MapPin, Briefcase, Trash2, Download, Plus, 
  Award, GraduationCap, Languages, FileText, LayoutTemplate, 
  Linkedin, Globe, ChevronRight, MessageSquare, HeartHandshake,
  BookOpen, Quote, Image as ImageIcon, MoveVertical, Settings2,
  Type, Palette, FileEdit, CheckCircle2, AlertCircle
} from 'lucide-react';

// --- CONFIGURAÇÕES DE BRANDING ---
const BRAND = {
  name: "Hanz Docs",
  colors: ['#0F172A', '#2563EB', '#10B981', '#F59E0B', '#EF4444', '#7C3AED'],
  fonts: ['Inter', 'Roboto', 'Playfair Display', 'Montserrat']
};

const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'hanz-docs-v1';

// --- DEFINIÇÃO DE TEMPLATES ---
const TEMPLATES = {
  cv: [
    { id: 'minimalista', name: 'Minimalista' },
    { id: 'corporativo', name: 'Corporativo' },
    { id: 'criativo', name: 'Criativo' },
    { id: 'executivo', name: 'Executivo' },
    { id: 'academico', name: 'Académico' },
    { id: 'tecnologico', name: 'Tecnológico' },
    { id: 'internacional', name: 'Internacional (Europass)' },
    { id: 'jovem', name: 'Jovem / 1º Emprego' },
    { id: 'gestao', name: 'Gestão & Liderança' },
    { id: 'tecnico', name: 'Técnico / Engenharia' }
  ],
  cover: [
    { id: 'c_emprego', name: 'Candidatura Emprego' },
    { id: 'c_estagio', name: 'Estágio' },
    { id: 'c_bolsa', name: 'Bolsa de Estudo' },
    { id: 'c_corp', name: 'Corporativa' },
    { id: 'c_formal', name: 'Formal Tradicional' },
    { id: 'c_moderna', name: 'Moderna Minimalista' },
    { id: 'c_criativa', name: 'Criativa' },
    { id: 'c_inter', name: 'Internacional' }
  ],
  motivation: [
    { id: 'm_bolsa', name: 'Bolsa de Estudo' },
    { id: 'm_uni', name: 'Universidade' },
    { id: 'm_mestrado', name: 'Mestrado' },
    { id: 'm_doutor', name: 'Doutoramento' },
    { id: 'm_ong', name: 'ONG / Voluntariado' },
    { id: 'm_visto', name: 'Visto de Estudo' },
    { id: 'm_inter', name: 'Prog. Internacional' },
    { id: 'm_gov', name: 'Oport. Governamental' }
  ]
};

// --- APP PRINCIPAL ---
export default function App() {
  const [activeView, setActiveView] = useState('editor');
  const [docType, setDocType] = useState('cv'); // cv, cover, motivation
  const [activeTab, setActiveTab] = useState('perfil');
  const [tone, setTone] = useState('profissional');
  
  // Estado Principal do Documento
  const [docData, setDocData] = useState({
    profile: {
      fullName: 'Arsénio Muianga',
      title: 'Especialista em Análise de Dados',
      email: 'arsenio.muianga@exemplo.mz',
      phone: '+258 84 123 4567',
      location: 'Maputo, Moçambique',
      linkedin: 'linkedin.com/in/arsenio',
      website: 'www.arsenio.mz',
      summary: 'Profissional resiliente focado em M&A e Transformação Digital, com 8 anos de experiência no mercado de Moçambique.',
      photo: null
    },
    letter: {
      recipient: 'Direção de Recursos Humanos\nVodacom Moçambique\nMaputo',
      subject: 'Candidatura à vaga de Gestor de Projetos Sénior',
      salutation: 'Exmos. Senhores,',
      body: 'Escrevo com grande entusiasmo para me candidatar à posição mencionada acima. Com a minha vasta experiência em gestão de dados e otimização de processos, acredito ser o candidato ideal para elevar os padrões operacionais da vossa organização.',
      signOff: 'Atentamente,',
      attachments: 'CV, Certificados Académicos'
    },
    sections: [
      { id: 'exp', title: 'Experiência Profissional', type: 'list', items: [{ id: '1', title: 'Analista Lead', subtitle: 'DataCorp MZ', period: '2021-2026', desc: 'Liderança de equipas multidisciplinares e automação de KPIs.' }] },
      { id: 'edu', title: 'Formação Académica', type: 'list', items: [{ id: '2', title: 'Licenciatura em Informática', subtitle: 'UEM', period: '2016-2020', desc: 'Média final de 17 valores.' }] },
      { id: 'cert', title: 'Certificações', type: 'list', items: [{ id: '3', title: 'PMP - Project Management', subtitle: 'PMI', period: '2022', desc: '' }] },
      { id: 'tech', title: 'Competências Técnicas', type: 'tags', items: ['Power BI', 'Python', 'SQL', 'RPA'] },
      { id: 'soft', title: 'Soft Skills', type: 'tags', items: ['Liderança', 'Comunicação', 'Pensamento Crítico'] },
      { id: 'lang', title: 'Idiomas', type: 'list', items: [{ id: '4', title: 'Português', subtitle: 'Nativo', period: '', desc: '' }, { id: '5', title: 'Inglês', subtitle: 'Avançado', period: '', desc: '' }] }
    ],
    config: {
      template: 'corporativo',
      accentColor: '#2563EB',
      font: 'Inter'
    }
  });

  // --- LÓGICA DE EDIÇÃO ---
  const updateProfile = (field, value) => {
    setDocData(prev => ({ ...prev, profile: { ...prev.profile, [field]: value } }));
  };

  const updateLetter = (field, value) => {
    setDocData(prev => ({ ...prev, letter: { ...prev.letter, [field]: value } }));
  };

  const addSection = () => {
    const title = prompt("Nome da nova seção:");
    if (!title) return;
    const newSec = { id: `sec_${Date.now()}`, title, type: 'list', items: [] };
    setDocData(prev => ({ ...prev, sections: [...prev.sections, newSec] }));
  };

  const removeSection = (id) => {
    setDocData(prev => ({ ...prev, sections: prev.sections.filter(s => s.id !== id) }));
    if (activeTab === id) setActiveTab('perfil');
  };

  const addItem = (sectionId) => {
    setDocData(prev => ({
      ...prev,
      sections: prev.sections.map(s => {
        if (s.id !== sectionId) return s;
        if (s.type === 'tags') return { ...s, items: [...s.items, 'Nova Habilidade'] };
        return { ...s, items: [...s.items, { id: Date.now().toString(), title: 'Novo Item', subtitle: '', period: '', desc: '' }] };
      })
    }));
  };

  const updateItem = (sectionId, itemId, field, value) => {
    setDocData(prev => ({
      ...prev,
      sections: prev.sections.map(s => {
        if (s.id !== sectionId) return s;
        return {
          ...s,
          items: s.items.map(i => (i.id === itemId ? { ...i, [field]: value } : i))
        };
      })
    }));
  };

  const removeItem = (sectionId, itemId) => {
    setDocData(prev => ({
      ...prev,
      sections: prev.sections.map(s => {
        if (s.id !== sectionId) return s;
        return { ...s, items: s.items.filter(i => i.id !== itemId) };
      })
    }));
  };

  const updateTag = (sectionId, index, value) => {
    setDocData(prev => ({
      ...prev,
      sections: prev.sections.map(s => {
        if (s.id !== sectionId) return s;
        const newItems = [...s.items];
        newItems[index] = value;
        return { ...s, items: newItems };
      })
    }));
  };

  // --- COMPONENTES DE PREVIEW ---
  const CVPreview = () => {
    const { profile, sections, config } = docData;
    const style = { fontFamily: config.font };

    return (
      <div className="bg-white shadow-2xl w-full min-h-[1120px] p-12 text-slate-800" style={style}>
        {/* Header */}
        <div className="flex justify-between items-start border-b-2 pb-8 mb-8" style={{ borderColor: config.accentColor }}>
          <div className="max-w-[70%]">
            <h1 className="text-4xl font-black uppercase tracking-tight mb-1">{profile.fullName}</h1>
            <p className="text-xl font-bold uppercase tracking-widest" style={{ color: config.accentColor }}>{profile.title}</p>
            <p className="mt-4 text-sm leading-relaxed text-slate-500 italic">{profile.summary}</p>
          </div>
          <div className="text-right text-[11px] font-bold space-y-1 text-slate-400">
             <div className="flex items-center justify-end gap-2"><Mail size={12}/> {profile.email}</div>
             <div className="flex items-center justify-end gap-2"><Phone size={12}/> {profile.phone}</div>
             <div className="flex items-center justify-end gap-2"><MapPin size={12}/> {profile.location}</div>
             <div className="flex items-center justify-end gap-2"><Linkedin size={12}/> {profile.linkedin}</div>
          </div>
        </div>

        {/* Content Grid */}
        <div className="grid grid-cols-12 gap-10">
          <div className="col-span-8 space-y-10">
            {sections.filter(s => s.type === 'list' && s.id !== 'lang').map(s => (
              <div key={s.id}>
                <h3 className="text-xs font-black uppercase tracking-[0.2em] mb-4 flex items-center gap-2">
                  <span className="w-6 h-px bg-slate-200"></span> {s.title}
                </h3>
                <div className="space-y-6">
                  {s.items.map(item => (
                    <div key={item.id} className="relative pl-4 border-l-2 border-slate-100">
                      <div className="flex justify-between items-start mb-1">
                        <h4 className="font-bold text-sm">{item.title}</h4>
                        <span className="text-[10px] font-black text-slate-300 uppercase">{item.period}</span>
                      </div>
                      <p className="text-[11px] font-bold uppercase mb-2" style={{ color: config.accentColor }}>{item.subtitle}</p>
                      <p className="text-xs text-slate-500 leading-relaxed">{item.desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>

          <div className="col-span-4 space-y-10">
            {sections.filter(s => s.type === 'tags' || s.id === 'lang').map(s => (
              <div key={s.id}>
                <h3 className="text-xs font-black uppercase tracking-[0.2em] mb-4">{s.title}</h3>
                {s.type === 'tags' ? (
                  <div className="flex flex-wrap gap-2">
                    {s.items.map((tag, idx) => (
                      <span key={idx} className="bg-slate-50 border border-slate-100 px-3 py-1 rounded-full text-[10px] font-bold text-slate-600 uppercase">
                        {tag}
                      </span>
                    ))}
                  </div>
                ) : (
                  <div className="space-y-3">
                    {s.items.map(item => (
                      <div key={item.id}>
                        <p className="text-[11px] font-black uppercase">{item.title}</p>
                        <p className="text-[10px] text-slate-400 font-bold uppercase">{item.subtitle}</p>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const LetterPreview = () => {
    const { profile, letter, config } = docData;
    return (
      <div className="bg-white shadow-2xl w-full min-h-[1120px] p-20 text-slate-800" style={{ fontFamily: config.font }}>
        <div className="flex justify-between items-start mb-16">
          <div className="text-sm">
            <h2 className="font-black text-xl mb-1">{profile.fullName}</h2>
            <p className="text-slate-500">{profile.location}</p>
            <p className="text-slate-400">{profile.email} | {profile.phone}</p>
          </div>
          <div className="text-right">
            <div className="w-12 h-12 bg-slate-900 ml-auto rounded-xl flex items-center justify-center text-white">
              <FileText />
            </div>
          </div>
        </div>

        <div className="text-right mb-12">
          <p className="text-sm text-slate-400 mb-8">{new Date().toLocaleDateString('pt-MZ', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
          <div className="text-sm font-bold">
            <p className="text-xs uppercase text-slate-300 mb-1">Para:</p>
            <p className="whitespace-pre-line">{letter.recipient}</p>
          </div>
        </div>

        <div className="mb-10">
          <p className="text-xs font-black uppercase tracking-widest text-slate-300 mb-1">Assunto:</p>
          <p className="font-bold border-b-2 pb-2 inline-block" style={{ borderColor: config.accentColor }}>{letter.subject}</p>
        </div>

        <p className="font-bold mb-6">{letter.salutation}</p>
        <p className="text-sm leading-[1.8] text-slate-600 mb-10 text-justify whitespace-pre-line">
          {letter.body}
        </p>

        <div className="space-y-8">
          <div>
            <p className="text-sm mb-12">{letter.signOff}</p>
            <div className="h-px w-48 bg-slate-200 mb-2"></div>
            <p className="font-black uppercase text-xs tracking-widest">{profile.fullName}</p>
          </div>
          
          {letter.attachments && (
            <div className="pt-8 border-t border-slate-50">
              <p className="text-[10px] font-black text-slate-300 uppercase tracking-widest">Anexos:</p>
              <p className="text-[10px] font-bold text-slate-500 italic">{letter.attachments}</p>
            </div>
          )}
        </div>
      </div>
    );
  };

  return (
    <div className="flex flex-col h-screen bg-slate-50 overflow-hidden font-sans">
      {/* HEADER BAR */}
      <header className="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shrink-0 z-50">
        <div className="flex items-center gap-3">
          <div className="bg-blue-600 p-2 rounded-lg text-white">
            <FileEdit size={20} />
          </div>
          <div>
            <h1 className="text-lg font-black tracking-tighter uppercase">{BRAND.name}</h1>
            <p className="text-[9px] font-bold text-slate-400 uppercase tracking-widest -mt-1">Gerador Profissional</p>
          </div>
        </div>

        <div className="flex items-center gap-2 bg-slate-100 p-1 rounded-xl">
          {[
            { id: 'cv', label: 'Currículo', icon: User },
            { id: 'cover', label: 'C. Apresentação', icon: MessageSquare },
            { id: 'motivation', label: 'C. Motivação', icon: HeartHandshake }
          ].map(type => (
            <button
              key={type.id}
              onClick={() => { setDocType(type.id); setActiveTab('perfil'); }}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg text-[10px] font-black uppercase transition-all ${docType === type.id ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
            >
              <type.icon size={14} /> {type.label}
            </button>
          ))}
        </div>

        <button 
          onClick={() => window.print()}
          className="bg-slate-900 text-white flex items-center gap-2 px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 transition-all shadow-lg shadow-slate-900/10"
        >
          <Download size={14} /> Exportar PDF
        </button>
      </header>

      <div className="flex flex-1 overflow-hidden">
        {/* SIDEBAR: ESTRUTURA E SEÇÕES */}
        <aside className="w-80 bg-white border-r border-slate-200 flex flex-col p-6 space-y-8 overflow-y-auto no-scrollbar shrink-0">
          <div>
            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center justify-between">
              Estrutura <Settings2 size={12} />
            </h3>
            <div className="space-y-1">
              <button 
                onClick={() => setActiveTab('perfil')}
                className={`w-full flex items-center justify-between p-3.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === 'perfil' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-50 text-slate-600 hover:bg-slate-100'}`}
              >
                <div className="flex items-center gap-3"><User size={14}/> Dados Pessoais</div>
                <ChevronRight size={12} />
              </button>

              {docType !== 'cv' && (
                <button 
                  onClick={() => setActiveTab('letter_content')}
                  className={`w-full flex items-center justify-between p-3.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === 'letter_content' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-50 text-slate-600 hover:bg-slate-100'}`}
                >
                  <div className="flex items-center gap-3"><FileText size={14}/> Conteúdo</div>
                  <ChevronRight size={12} />
                </button>
              )}

              {docType === 'cv' && docData.sections.map(s => (
                <div key={s.id} className="flex gap-1">
                  <button 
                    onClick={() => setActiveTab(s.id)}
                    className={`flex-1 flex items-center justify-between p-3.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === s.id ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-50 text-slate-600 hover:bg-slate-100'}`}
                  >
                    <div className="flex items-center gap-3"><LayoutTemplate size={14}/> {s.title}</div>
                  </button>
                  <button onClick={() => removeSection(s.id)} className="p-3 text-red-400 hover:text-red-600"><Trash2 size={14}/></button>
                </div>
              ))}
            </div>

            {docType === 'cv' && (
              <button onClick={addSection} className="w-full mt-4 flex items-center justify-center gap-2 p-3 border-2 border-dashed border-slate-200 rounded-xl text-[10px] font-black uppercase text-slate-400 hover:border-blue-400 hover:text-blue-500 transition-all">
                <Plus size={14}/> Nova Seção
              </button>
            )}
          </div>

          <div>
            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Estilo Visual</h3>
            <div className="space-y-4">
               <div className="space-y-2">
                  <p className="text-[9px] font-bold text-slate-400 uppercase">Template</p>
                  <select 
                    value={docData.config.template}
                    onChange={(e) => setDocData({...docData, config: {...docData.config, template: e.target.value}})}
                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold outline-none"
                  >
                    {TEMPLATES[docType].map(t => <option key={t.id} value={t.id}>{t.name}</option>)}
                  </select>
               </div>

               <div className="space-y-2">
                  <p className="text-[9px] font-bold text-slate-400 uppercase">Cor de Destaque</p>
                  <div className="flex gap-2">
                    {BRAND.colors.map(c => (
                      <button 
                        key={c}
                        onClick={() => setDocData({...docData, config: {...docData.config, accentColor: c}})}
                        className={`w-6 h-6 rounded-full border-2 ${docData.config.accentColor === c ? 'border-slate-400 scale-110' : 'border-transparent'}`}
                        style={{ backgroundColor: c }}
                      />
                    ))}
                  </div>
               </div>
            </div>
          </div>
        </aside>

        {/* CENTER: EDITOR DE CAMPOS */}
        <main className="w-[450px] bg-white border-r border-slate-200 p-8 overflow-y-auto no-scrollbar shrink-0">
          <div className="max-w-md mx-auto space-y-8">
            <div className="flex items-center gap-2 text-blue-600 mb-2">
              <PencilIcon activeTab={activeTab} />
              <h2 className="text-xs font-black uppercase tracking-widest">{activeTab === 'perfil' ? 'Dados Pessoais' : 'Edição de Seção'}</h2>
            </div>

            {activeTab === 'perfil' && (
              <div className="space-y-4">
                <InputField label="Nome Completo" value={docData.profile.fullName} onChange={(v) => updateProfile('fullName', v)} />
                <InputField label="Título Profissional" value={docData.profile.title} onChange={(v) => updateProfile('title', v)} />
                <div className="grid grid-cols-2 gap-4">
                  <InputField label="Email" value={docData.profile.email} onChange={(v) => updateProfile('email', v)} />
                  <InputField label="Telefone" value={docData.profile.phone} onChange={(v) => updateProfile('phone', v)} />
                </div>
                <InputField label="LinkedIn" value={docData.profile.linkedin} onChange={(v) => updateProfile('linkedin', v)} />
                <InputField label="Localização" value={docData.profile.location} onChange={(v) => updateProfile('location', v)} />
                <TextArea label="Resumo / Bio" value={docData.profile.summary} onChange={(v) => updateProfile('summary', v)} />
              </div>
            )}

            {activeTab === 'letter_content' && (
              <div className="space-y-4">
                <TextArea label="Destinatário" value={docData.letter.recipient} onChange={(v) => updateLetter('recipient', v)} />
                <InputField label="Assunto" value={docData.letter.subject} onChange={(v) => updateLetter('subject', v)} />
                <div className="p-4 bg-blue-50 rounded-xl border border-blue-100 mb-4">
                   <p className="text-[10px] font-black text-blue-600 uppercase mb-2">Sugestão de Tom</p>
                   <div className="flex gap-2">
                     {['profissional', 'formal', 'confiante', 'criativo'].map(t => (
                        <button key={t} onClick={() => setTone(t)} className={`px-3 py-1.5 rounded-lg text-[9px] font-black uppercase ${tone === t ? 'bg-blue-600 text-white' : 'bg-white text-blue-400'}`}>{t}</button>
                     ))}
                   </div>
                </div>
                <TextArea label="Corpo da Carta" value={docData.letter.body} onChange={(v) => updateLetter('body', v)} height="300px" />
                <InputField label="Anexos" value={docData.letter.attachments} onChange={(v) => updateLetter('attachments', v)} />
              </div>
            )}

            {docData.sections.find(s => s.id === activeTab) && (
              <div className="space-y-6">
                {docData.sections.find(s => s.id === activeTab).items.map((item, idx) => (
                  <div key={item.id || idx} className="p-5 bg-slate-50 rounded-2xl border border-slate-100 relative group">
                    <button 
                      onClick={() => removeItem(activeTab, item.id || idx)}
                      className="absolute top-4 right-4 text-slate-300 hover:text-red-500 transition-colors"
                    >
                      <Trash2 size={14} />
                    </button>
                    {typeof item === 'string' ? (
                      <InputField label={`Habilidade #${idx + 1}`} value={item} onChange={(v) => updateTag(activeTab, idx, v)} />
                    ) : (
                      <div className="space-y-4">
                        <InputField label="Título / Cargo" value={item.title} onChange={(v) => updateItem(activeTab, item.id, 'title', v)} />
                        <InputField label="Instituição / Subtítulo" value={item.subtitle} onChange={(v) => updateItem(activeTab, item.id, 'subtitle', v)} />
                        <InputField label="Período" value={item.period} onChange={(v) => updateItem(activeTab, item.id, 'period', v)} />
                        <TextArea label="Descrição / Detalhes" value={item.desc} onChange={(v) => updateItem(activeTab, item.id, 'desc', v)} />
                      </div>
                    )}
                  </div>
                ))}
                <button 
                  onClick={() => addItem(activeTab)}
                  className="w-full flex items-center justify-center gap-2 p-4 bg-blue-50 text-blue-600 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-100 transition-all"
                >
                  <Plus size={16} /> Adicionar Item
                </button>
              </div>
            )}
          </div>
        </main>

        {/* RIGHT: PREVIEW CANVAS */}
        <section className="flex-1 bg-slate-200/50 p-12 overflow-y-auto no-scrollbar flex flex-col items-center">
          <div className="max-w-[800px] w-full origin-top transform scale-[0.95]">
             <div className="flex justify-between items-center mb-6 w-full text-[10px] font-black uppercase text-slate-400 tracking-[0.3em]">
                <span>Visualização A4</span>
                <span className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div> Sincronizado</span>
             </div>
             
             {docType === 'cv' ? <CVPreview /> : <LetterPreview />}
          </div>
          
          <div className="mt-8 text-center text-slate-400 max-w-md">
            <p className="text-[10px] font-bold uppercase tracking-widest leading-relaxed">
              Dica: O Hanz Docs gera automaticamente a estrutura ideal baseada no mercado moçambicano e internacional. Certifique-se de que os seus contactos estão corretos.
            </p>
          </div>
        </section>
      </div>

      {/* FOOTER STATS */}
      <footer className="h-10 bg-white border-t border-slate-200 px-6 flex items-center justify-between shrink-0">
        <div className="flex gap-4 text-[9px] font-black text-slate-400 uppercase">
          <span>Hanz Docs v3.0</span>
          <span className="text-blue-500">Pronto para exportar</span>
        </div>
        <div className="flex gap-2 items-center">
          <div className="h-1.5 w-32 bg-slate-100 rounded-full overflow-hidden">
            <div className="h-full bg-blue-500 w-3/4"></div>
          </div>
          <span className="text-[9px] font-bold text-slate-400">75% Completo</span>
        </div>
      </footer>

      {/* PRINT STYLE OVERRIDE */}
      <style>{`
        @media print {
          body * { visibility: hidden; }
          .bg-white.shadow-2xl, .bg-white.shadow-2xl * { visibility: visible; }
          .bg-white.shadow-2xl { position: absolute; left: 0; top: 0; width: 100% !important; box-shadow: none !important; margin: 0 !important; padding: 0 !important; }
          aside, header, main, footer { display: none !important; }
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      `}</style>
    </div>
  );
}

// --- SUBCOMPONENTES DE UI ---

function InputField({ label, value, onChange }) {
  return (
    <div className="space-y-1">
      <label className="text-[9px] font-black uppercase text-slate-400 tracking-wider block ml-1">{label}</label>
      <input 
        type="text"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        className="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-xs font-bold outline-none focus:bg-white focus:border-blue-500 transition-all"
      />
    </div>
  );
}

function TextArea({ label, value, onChange, height = "100px" }) {
  return (
    <div className="space-y-1">
      <label className="text-[9px] font-black uppercase text-slate-400 tracking-wider block ml-1">{label}</label>
      <textarea 
        value={value}
        onChange={(e) => onChange(e.target.value)}
        style={{ height }}
        className="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl text-xs font-medium outline-none focus:bg-white focus:border-blue-500 transition-all leading-relaxed no-scrollbar"
      />
    </div>
  );
}

function PencilIcon({ activeTab }) {
  if (activeTab === 'perfil') return <User size={14} />;
  if (activeTab === 'letter_content') return <FileText size={14} />;
  return <LayoutTemplate size={14} />;
}
