<!DOCTYPE html>
<html lang="pt-MZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HanzDocs AI | Documentos Profissionais em Moçambique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .card-hover:hover { transform: translateY(-5px); transition: all 0.3s ease; }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .a4-preview {
            background: white;
            box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.1);
            line-height: 1.6;
            font-family: 'Times New Roman', serif;
            position: relative;
            min-height: 297mm;
            width: 100%;
            max-width: 210mm;
            margin: auto;
        }

        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 60px;
            font-weight: 900;
            color: rgba(0,0,0,0.03);
            pointer-events: none;
            user-select: none;
            white-space: nowrap;
            z-index: 0;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .a4-preview { box-shadow: none; border: none; margin: 0; padding: 20mm; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Navegação -->
    <nav class="glass sticky top-0 z-50 border-b border-slate-200 px-6 py-4 flex justify-between items-center no-print">
        <div class="flex items-center gap-2 font-black text-2xl text-blue-600 cursor-pointer" onclick="location.reload()">
            <i class="fas fa-file-contract"></i>
            <span>HanzDocs <span class="text-slate-800">AI</span></span>
        </div>
        
        <div class="hidden md:flex gap-8 text-sm font-bold text-slate-500">
            <a href="#servicos" class="hover:text-blue-600 transition">Serviços</a>
            <a href="#precos" class="hover:text-blue-600 transition">Preços</a>
            <a href="#meus-docs" class="hover:text-blue-600 transition">Meus Docs</a>
        </div>

        <div class="flex items-center gap-4">
            <div id="user-profile" class="hidden flex items-center gap-3">
                <span id="user-email" class="hidden lg:inline text-xs font-bold text-slate-500 border px-3 py-1.5 rounded-full bg-white"></span>
                <button onclick="handleLogout()" class="text-xs font-bold text-red-500 hover:bg-red-50 px-3 py-1.5 rounded-lg transition">Sair</button>
            </div>
            <button id="login-btn" onclick="toggleLogin()" class="text-sm font-bold text-slate-600 hover:text-blue-600">Entrar</button>
            <button onclick="scrollToGerador()" class="bg-blue-600 text-white px-5 py-2.5 rounded-full font-bold text-sm hover:bg-blue-700 transition shadow-lg shadow-blue-100">
                Criar Novo
            </button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="pt-20 pb-12 px-6 text-center no-print">
        <div class="max-w-4xl mx-auto">
            <span class="bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-xs font-black uppercase tracking-widest mb-6 inline-block">Inteligência Artificial em Moçambique</span>
            <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-[1.1] text-slate-900 tracking-tight">
                Documentos que te dão <br><span class="text-blue-600">o emprego.</span>
            </h1>
            <p class="text-lg text-slate-600 mb-10 max-w-2xl mx-auto font-medium">
                Gere currículos, cartas e contratos otimizados para o mercado nacional usando a IA do Gemini em segundos.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="scrollToGerador()" class="bg-slate-900 text-white px-8 py-4 rounded-2xl font-bold hover:bg-blue-600 transition flex items-center justify-center gap-3">
                    Começar Agora <i class="fas fa-arrow-right text-xs"></i>
                </button>
                <a href="#precos" class="bg-white border border-slate-200 text-slate-700 px-8 py-4 rounded-2xl font-bold hover:bg-slate-50 transition">Ver Planos</a>
            </div>
        </div>
    </section>

    <!-- Gerador Principal -->
    <section id="gerador" class="py-12 px-6 no-print">
        <div class="max-w-6xl mx-auto bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 overflow-hidden flex flex-col lg:flex-row min-h-[700px]">
            
            <!-- Painel de Inputs -->
            <div class="lg:w-80 xl:w-96 p-8 border-r border-slate-50 flex flex-col bg-slate-50/50">
                <div class="flex items-center gap-2 mb-8 text-blue-600">
                    <i class="fas fa-magic"></i>
                    <h2 class="font-black uppercase text-xs tracking-tighter">Configuração de IA</h2>
                </div>

                <div class="space-y-5 flex-1">
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-2">O que deseja criar?</label>
                        <select id="doc-type" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none font-medium bg-white">
                            <option value="cv">Currículo (CV) Profissional</option>
                            <option value="carta">Carta de Apresentação</option>
                            <option value="contrato">Contrato de Arrendamento</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-2">Teu Nome Completo</label>
                        <input type="text" id="user-name" placeholder="Ex: Arlindo José" class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    </div>

                    <div>
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-2">Telefone (Contactos)</label>
                        <input type="text" id="user-phone" placeholder="+258 84..." class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none bg-white">
                    </div>

                    <div>
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-2">Contexto para a IA</label>
                        <textarea id="user-desc" rows="6" placeholder="Ex: Sou graduado em contabilidade, tenho 2 anos de experiência..." class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-white"></textarea>
                    </div>
                </div>

                <button onclick="gerarDocumentoComIA()" id="btn-gerar" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold hover:bg-blue-700 transition flex items-center justify-center gap-3 mt-8 shadow-lg shadow-blue-100">
                    <i class="fas fa-sparkles"></i> Gerar Documento
                </button>
            </div>

            <!-- Área de Preview -->
            <div class="flex-1 bg-slate-200/50 p-4 md:p-10 flex flex-col items-center overflow-y-auto max-h-[800px]">
                
                <div id="preview-placeholder" class="my-auto text-center opacity-40">
                    <i class="fas fa-file-invoice text-7xl mb-4"></i>
                    <p class="font-bold">O preview aparecerá aqui</p>
                </div>

                <div id="loading-state" class="hidden my-auto text-center">
                    <div class="loader mb-4"></div>
                    <p class="text-blue-600 font-black">A redigir com Inteligência Artificial...</p>
                </div>

                <div id="result-state" class="hidden w-full flex flex-col items-center fade-in">
                    <div class="flex justify-between w-full max-w-[210mm] mb-6 items-center">
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest bg-white px-3 py-1 rounded-full border border-slate-200">A4 Preview Mode</span>
                        <div class="flex gap-2">
                             <button onclick="copiarTexto()" class="text-xs font-bold text-slate-600 bg-white border border-slate-200 px-3 py-2 rounded-lg hover:bg-slate-50">Copiar</button>
                             <button onclick="window.print()" class="text-xs font-bold text-blue-600 bg-white border border-blue-100 px-3 py-2 rounded-lg hover:bg-blue-50">Imprimir</button>
                        </div>
                    </div>
                    
                    <div class="a4-preview p-[20mm] text-slate-800" id="doc-output">
                        <div class="watermark">HanzDocs AI</div>
                        <!-- Injetado por JS -->
                    </div>

                    <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-[210mm]">
                        <button onclick="handlePayment('unit')" class="bg-blue-600 text-white py-4 rounded-2xl font-black flex items-center justify-center gap-3 hover:bg-blue-700 shadow-xl shadow-blue-200 transition">
                            <i class="fas fa-cloud-download-alt"></i> Baixar PDF HD (50 MT)
                        </button>
                        <button class="bg-slate-900 text-white py-4 rounded-2xl font-black flex items-center justify-center gap-3 hover:bg-slate-800 transition">
                            <i class="fas fa-share-nodes"></i> Partilhar Link
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Secção de Preços -->
    <section id="precos" class="py-24 px-6 bg-white no-print">
        <div class="max-w-6xl mx-auto text-center">
            <h2 class="text-4xl font-black mb-4">Escolha o seu plano</h2>
            <p class="text-slate-500 mb-16">Pague uma vez ou subscreva para acesso ilimitado.</p>
            
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Unitário -->
                <div class="p-8 border border-slate-100 rounded-[2.5rem] bg-slate-50/50 text-left">
                    <h3 class="font-bold text-xl mb-2">Documento Único</h3>
                    <div class="text-3xl font-black mb-6">50 MT <span class="text-sm font-normal text-slate-400">/doc</span></div>
                    <ul class="space-y-3 text-sm text-slate-600 mb-8">
                        <li><i class="fas fa-check text-green-500 mr-2"></i> 1 Download PDF</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i> IA Gemini Flash</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Validade 24h</li>
                    </ul>
                    <button onclick="handlePayment('unit')" class="w-full py-4 border-2 border-slate-200 rounded-2xl font-bold hover:bg-white transition">Pagar via M-Pesa</button>
                </div>
                <!-- Mensal -->
                <div class="p-8 border-4 border-blue-600 rounded-[2.5rem] bg-white text-left relative shadow-2xl shadow-blue-100 scale-105">
                    <span class="absolute -top-4 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase">Recomendado</span>
                    <h3 class="font-bold text-xl mb-2">Mensal Pro</h3>
                    <div class="text-3xl font-black mb-6">450 MT <span class="text-sm font-normal text-slate-400">/mês</span></div>
                    <ul class="space-y-3 text-sm text-slate-600 mb-8">
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Documentos Ilimitados</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Suporte 24/7</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Sem Marcas de Água</li>
                    </ul>
                    <button onclick="handlePayment('pro')" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold hover:bg-blue-700 transition">Assinar com M-Pesa</button>
                </div>
                <!-- Empresas -->
                <div class="p-8 border border-slate-100 rounded-[2.5rem] bg-slate-50/50 text-left">
                    <h3 class="font-bold text-xl mb-2">Empresas</h3>
                    <div class="text-3xl font-black mb-6">Custom</div>
                    <ul class="space-y-3 text-sm text-slate-600 mb-8">
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Branding Personalizado</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Acesso via API</li>
                        <li><i class="fas fa-check text-green-500 mr-2"></i> Multi-utilizadores</li>
                    </ul>
                    <button class="w-full py-4 border-2 border-slate-200 rounded-2xl font-bold hover:bg-white transition">Contactar Vendas</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Secção Meus Documentos -->
    <section id="meus-docs" class="py-24 px-6 bg-slate-50 no-print">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-end mb-10">
                <div>
                    <h2 class="text-3xl font-black italic">Os Meus <span class="text-blue-600">Documentos</span></h2>
                    <p class="text-slate-500 font-medium">Acede aos teus ficheiros guardados em qualquer lugar.</p>
                </div>
                <button onclick="loadUserDocuments()" class="text-blue-600 font-bold text-sm hover:underline"><i class="fas fa-sync-alt mr-2"></i>Atualizar</button>
            </div>
            
            <div id="docs-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Lista será injetada aqui -->
                <div class="col-span-full py-20 text-center bg-white border-2 border-dashed border-slate-200 rounded-[3rem]">
                    <i class="fas fa-lock text-slate-200 text-5xl mb-4"></i>
                    <p class="text-slate-400 font-bold">Inicia sessão para guardar documentos na nuvem.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de Login -->
    <div id="login-modal" class="hidden fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center px-6 no-print">
        <div class="bg-white rounded-[2.5rem] p-10 max-w-sm w-full shadow-2xl relative">
            <button onclick="toggleLogin()" class="absolute top-6 right-6 text-slate-300 hover:text-slate-600">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-600 text-white rounded-2xl flex items-center justify-center mx-auto mb-4 rotate-3">
                    <i class="fas fa-user-shield text-2xl"></i>
                </div>
                <h3 class="text-2xl font-black">Aceder HanzDocs</h3>
                <p class="text-slate-500 text-sm font-medium">Sincroniza os teus dados agora.</p>
            </div>

            <button onclick="handleGoogleLogin()" class="w-full border-2 border-slate-100 py-3.5 rounded-2xl font-black flex items-center justify-center gap-3 hover:bg-slate-50 transition mb-4 text-sm">
                <img src="https://www.google.com/favicon.ico" class="w-4 h-4" alt="Google"> Google Login
            </button>
            
            <div class="relative py-4">
                <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-100"></div></div>
                <div class="relative flex justify-center text-[10px] uppercase font-black"><span class="bg-white px-3 text-slate-400 tracking-tighter">Ou Magic Link</span></div>
            </div>
            
            <input type="email" id="email-input" placeholder="Teu email (Gmail/Outlook)" class="w-full px-5 py-4 rounded-2xl border-2 border-slate-100 mb-4 outline-none focus:border-blue-500 transition font-medium">
            <button id="magic-link-btn" onclick="handleMagicLink()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black hover:bg-blue-600 transition shadow-lg shadow-blue-100">
                Enviar Link de Acesso
            </button>
        </div>
    </div>

    <footer class="py-12 bg-white border-t border-slate-100 text-center no-print">
        <p class="text-slate-400 text-xs font-bold uppercase tracking-widest leading-loose">
            © 2024 HanzDocs AI — Made with <i class="fas fa-heart text-red-500"></i> in Mozambique
        </p>
    </footer>

    <script>
        // --- CONFIGURAÇÃO ---
        const apiKey = ""; // Gemini API Key injetada pelo Canvas
        const SUPABASE_URL = 'https://vbxqwabfwrafomuiiedh.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_QCB11qPe_6raIdDVussbpQ_VZ2W_acc';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;

        // --- AUTH LOGIC ---
        window.onload = async () => {
            const { data: { session } } = await supabaseClient.auth.getSession();
            currentUser = session?.user;
            updateUI(currentUser);
            if(currentUser) loadUserDocuments();

            supabaseClient.auth.onAuthStateChange((_event, session) => {
                currentUser = session?.user;
                updateUI(currentUser);
                if(currentUser) loadUserDocuments();
            });
        };

        function updateUI(user) {
            const profileDiv = document.getElementById('user-profile');
            const loginBtn = document.getElementById('login-btn');
            const userEmailSpan = document.getElementById('user-email');

            if (user) {
                profileDiv.classList.remove('hidden');
                loginBtn.classList.add('hidden');
                userEmailSpan.innerText = user.email;
                toggleLogin(true);
            } else {
                profileDiv.classList.add('hidden');
                loginBtn.classList.remove('hidden');
            }
        }

        function toggleLogin(forceClose = false) {
            const modal = document.getElementById('login-modal');
            if (forceClose) modal.classList.add('hidden');
            else modal.classList.toggle('hidden');
        }

        async function handleGoogleLogin() {
            const { error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: { redirectTo: window.location.origin }
            });
            if (error) alert("Erro ao conectar Google. Tente Magic Link.");
        }

        async function handleMagicLink() {
            const email = document.getElementById('email-input').value;
            if (!email) return alert("Insira o email.");
            const { error } = await supabaseClient.auth.signInWithOtp({
                email: email,
                options: { emailRedirectTo: window.location.origin }
            });
            if (error) alert(error.message);
            else alert("Link enviado! Verifique a sua caixa de entrada.");
        }

        async function handleLogout() {
            await supabaseClient.auth.signOut();
            location.reload();
        }

        // --- IA & GERADOR ---
        async function gerarDocumentoComIA() {
            const name = document.getElementById('user-name').value;
            const desc = document.getElementById('user-desc').value;
            const type = document.getElementById('doc-type').value;
            const phone = document.getElementById('user-phone').value || "+258";

            if (!name || !desc) return alert("Preencha o Nome e o Contexto!");

            document.getElementById('preview-placeholder').classList.add('hidden');
            document.getElementById('result-state').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('btn-gerar').disabled = true;

            const prompt = `Gera um documento profissional para ${name} (${phone}) do tipo ${type}. 
            Contexto: ${desc}. 
            Retorna APENAS o HTML (sem markdown blocks) formatado para A4.
            Usa CSS inline para aspeto formal (serif, bold headers, padding decente). 
            Se for CV, usa estrutura moçambicana (Dados Pessoais, Perfil, Exp, Formação).
            Adiciona títulos claros.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text.replace(/```html|```/g, '').trim();
                
                const output = document.getElementById('doc-output');
                output.innerHTML = `<div class="watermark">HanzDocs AI</div>` + content;
                
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('result-state').classList.remove('hidden');

                // Auto-save se logado
                if(currentUser) saveDocument(type, `${type.toUpperCase()} - ${name}`, content);

            } catch (err) {
                alert("Erro ao conectar com a IA. Tente novamente.");
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('preview-placeholder').classList.remove('hidden');
            } finally {
                document.getElementById('btn-gerar').disabled = false;
            }
        }

        // --- STORAGE ---
        async function loadUserDocuments() {
            if(!currentUser) return;
            const docsList = document.getElementById('docs-list');
            docsList.innerHTML = '<div class="col-span-full text-center font-bold animate-pulse">A carregar os teus documentos...</div>';

            const { data, error } = await supabaseClient
                .from('user_documents')
                .select('*')
                .eq('user_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (data && data.length > 0) {
                docsList.innerHTML = data.map(doc => `
                    <div class="bg-white p-6 rounded-[2rem] border border-slate-100 card-hover cursor-pointer shadow-sm" onclick="viewSavedDoc('${doc.id}')">
                        <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center mb-4">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h4 class="font-bold text-slate-800 truncate text-sm">${doc.title}</h4>
                        <p class="text-[10px] text-slate-400 mt-1 uppercase font-black tracking-widest">${new Date(doc.created_at).toLocaleDateString()}</p>
                    </div>
                `).join('');
            } else {
                docsList.innerHTML = '<div class="col-span-full py-20 text-center text-slate-400 italic">Ainda não criaste nenhum documento.</div>';
            }
        }

        async function saveDocument(type, title, content) {
            const { error } = await supabaseClient
                .from('user_documents')
                .insert([{ user_id: currentUser.id, type, title, content }]);
            if (!error) loadUserDocuments();
        }

        async function viewSavedDoc(id) {
            const { data } = await supabaseClient.from('user_documents').select('*').eq('id', id).single();
            if (data) {
                document.getElementById('doc-output').innerHTML = `<div class="watermark">HanzDocs AI</div>` + data.content;
                document.getElementById('preview-placeholder').classList.add('hidden');
                document.getElementById('result-state').classList.remove('hidden');
                scrollToGerador();
            }
        }

        // --- UTILITÁRIOS ---
        function scrollToGerador() { document.getElementById('gerador').scrollIntoView({ behavior: 'smooth' }); }
        
        function copiarTexto() {
            const text = document.getElementById('doc-output').innerText;
            const btn = event.target;
            navigator.clipboard.writeText(text);
            btn.innerText = "Copiado!";
            setTimeout(() => btn.innerText = "Copiar", 2000);
        }

        function handlePayment(plan) {
            const phone = prompt("Insira o seu número M-Pesa (84/85):");
            if (phone) {
                alert(`Solicitação de pagamento enviada para ${phone}. Por favor, introduza o PIN no seu telemóvel.`);
            }
        }
    </script>
</body>
</html>
